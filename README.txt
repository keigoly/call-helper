==============================================================
BlueBean 連携用 音声ガイダンス＆録音制御アプリ
セットアップガイド
==============================================================

このファイルでは、ZIPを展開した後の手順をすべて説明します。
上から順番に進めてください。


==============================================================
STEP 1: フォルダの配置
==============================================================

  1. 展開してできたフォルダを、わかりやすい場所に移動します。

     おすすめの配置先:
       C:\BlueBean-CallHelper

     フォルダの中身が以下のようになっていれば OK です:

       C:\BlueBean-CallHelper\
         call_helper.exe              ... アプリ本体
         config.ini                   ... 設定ファイル
         guidance.mp3                 ... 音声ガイダンス
         VBCABLE_Driver_Pack45.zip    ... 仮想オーディオドライバ
         VoicemeeterSetup_v2122.zip   ... 音声ミキサー（VoiceMeeter）
         README.txt                   ... このファイル


==============================================================
STEP 2: VB-Audio Virtual Cable のインストール
==============================================================

  このソフトは「仮想マイク」を作るドライバです。
  音声ガイダンスを BlueBean に送るために必要です。

  1. フォルダ内の「VBCABLE_Driver_Pack45.zip」をダブルクリックして開く

  2. 中にあるファイルをすべてデスクトップなど適当な場所に展開する
     (ZIPの中身を直接実行するとエラーになる場合があります)

  3. 展開したファイルの中から以下を探す:
       VBCABLE_Setup_x64.exe    (64bit版 Windows の場合)
       VBCABLE_Setup.exe        (32bit版 Windows の場合)

     ※ どちらかわからない場合は「VBCABLE_Setup_x64.exe」を使ってください。
        現在のほとんどの PC は 64bit 版です。

  4. 見つけたファイルを「右クリック」する

  5. メニューから「管理者として実行」をクリックする
     (通常のダブルクリックではインストールできません)

  6. 「Install Driver」ボタンをクリックする

  7. インストール完了のメッセージが出たら OK を押す

  8. パソコンを再起動する
     (再起動しないとデバイスが認識されません)


==============================================================
STEP 3: VoiceMeeter のインストール
==============================================================

  VoiceMeeter は複数の音声を合成するミキサーソフトです。
  物理マイク（自分の声）と音声ガイダンスの両方を
  BlueBean に送るために必要です。

  1. フォルダ内の「VoicemeeterSetup_v2122.zip」をダブルクリックして開く

  2. 中にあるファイルをすべてデスクトップなど適当な場所に展開する

  3. 展開したファイルの中から以下を探す:
       VoicemeeterSetup.exe    (標準版)
       VoicemeeterSetup_x64.exe があればそちらを使用

  4. 見つけたファイルを「右クリック」→「管理者として実行」

  5. 画面の指示に従ってインストールする

  6. インストール完了後、パソコンを再起動する


==============================================================
STEP 4: インストールの確認
==============================================================

  再起動後、両方が正しくインストールされたか確認します。

  1. 画面右下のスピーカーアイコンを右クリック

  2.「サウンドの設定」をクリック

  3. 下の方にスクロールして「サウンドの詳細設定」をクリック

  4.「録音」タブをクリック

  5. 一覧に以下の両方が表示されていれば OK:
       - CABLE Output (VB-Audio Virtual Cable)
       - VoiceMeeter Output (VB-Audio VoiceMeeter VAIO)

  ※ 表示されていない場合:
     → 一覧内で右クリック →「無効なデバイスの表示」をチェック
     → それでも表示されない場合は STEP 2 または STEP 3 をやり直してください


==============================================================
STEP 5: VoiceMeeter の設定
==============================================================

  VoiceMeeter を起動して、音声の入力元を設定します。

  1. スタートメニューから「VoiceMeeter」を起動する

  2. 左上の「HARDWARE INPUT 1」をクリック
     → 一覧から、お使いの物理マイクを選択する
     （例: WDM: マイク (Realtek Audio) など）

     ※ これにより、通話中に自分の声が相手に届くようになります

  3. 右上の「HARDWARE INPUT 2」をクリック
     → 一覧から「WDM: CABLE Output (VB-Audio Virtual Cable)」を選択する

     ※ これにより、音声ガイダンスが相手に届くようになります

  4. HARDWARE INPUT 1 と HARDWARE INPUT 2 の両方で
     「B1」ボタンが点灯（有効）していることを確認する

     ※ B1 が消灯している場合はクリックして有効にしてください
     ※ B1 を有効にすると、その入力が VoiceMeeter Output に送られます

  ---------- 動作の仕組み ----------

  以下のように音声が合成されて BlueBean に届きます:

    物理マイク（自分の声）─→ VoiceMeeter ─→ BlueBean
    CABLE Output（ガイダンス）─→ VoiceMeeter ─↗

  ガイダンス再生中は物理マイクとスピーカーが自動でミュートされるため、
  お互いの声が遮断され、ガイダンスだけが相手に届きます。
  再生が終わるとミュートが解除され、普通に会話できるようになります。

  ---------- 自動起動の設定（推奨） ----------

  VoiceMeeter は PC 起動時に自動で立ち上がるようにしておくと便利です。

  1. VoiceMeeter のメニューバーから「Menu」をクリック
  2.「System Tray (Run at Startup)」にチェックを入れる

  ※ これを設定しないと、PC を再起動するたびに
    VoiceMeeter を手動で起動する必要があります。


==============================================================
STEP 6: config.ini の編集
==============================================================

  設定ファイルを、お使いの環境に合わせて編集します。

  1. フォルダ内の「config.ini」を右クリック

  2.「プログラムから開く」→「メモ帳」を選ぶ

  3. ファイルの中身が以下のようになっています:

     ---ここから---
     [general]
     guidance_file = guidance.mp3

     [audio]
     virtual_cable_name = CABLE Input (VB-Audio Virtual Cable)

     [recording]
     output_folder = D:\CallRecordings
     recording_device = Voicemeeter Out B1
     max_duration_minutes = 120
     ---ここまで---

  4. 変更が必要な箇所:

     ● guidance_file (通常は変更不要)
       音声ガイダンスファイルの名前です。
       guidance.mp3 を別のファイルに差し替えた場合のみ変更してください。

     ● virtual_cable_name (通常は変更不要)
       STEP 2 でインストールした仮想デバイスの名前です。

     ● output_folder (環境に合わせて変更)
       録音した MP3 ファイルの保存先フォルダです。
       例: D:\CallRecordings

     ● recording_device (通常は変更不要)
       録音に使う入力デバイス名です。

     ● max_duration_minutes (通常は変更不要)
       録音の安全上限（分）です。この時間を超えると自動停止します。

     【重要】値にダブルクォート（"）を付けないでください。
       正しい例: guidance_file = guidance.mp3
       誤った例: guidance_file = "guidance.mp3"
       ダブルクォートを付けると、ファイルが正しく見つからなくなります。

  5. 編集が終わったら「Ctrl + S」で保存してメモ帳を閉じる


==============================================================
STEP 7: 動作テスト
==============================================================

  BlueBean に登録する前に、まず単体で動くか確認します。

  ---------- テスト方法 ----------

  1. VoiceMeeter が起動していることを確認する

  2. フォルダ内のアドレスバー（上部のパスが表示されている部分）をクリック

  3.「cmd」と入力して Enter キーを押す
     → コマンドプロンプト（黒い画面）が開きます

  4. 以下を入力して Enter キーを押す:

       call_helper.exe --mode=incoming --number=0312345678

  5. 期待される動作:
     - マイクとスピーカーが一時的にミュートされる
     - 音声ガイダンスが再生される（PCのスピーカーからは聞こえません）
     - 再生が終わるとピー音が鳴る
     - マイクとスピーカーのミュートが解除される
     - 「call_helper 終了」と表示される

  6. フォルダ内に「call_helper.log」が作成されていれば成功です
     メモ帳で開くと実行ログを確認できます。

  ※ 「仮想ケーブルデバイスが見つかりません」と表示された場合:
     → STEP 2 と STEP 4 を確認してください

  ※ 「音声ファイルが見つかりません」と表示された場合:
     → guidance.mp3 が call_helper.exe と同じフォルダにあるか確認してください
     → config.ini の値にダブルクォート（"）が付いていないか確認してください
       （STEP 6 の【重要】を参照）


==============================================================
STEP 8: BlueBean との連携設定
==============================================================

  BlueBean の通話応答時に自動でこのアプリが起動するように設定します。

  ---------- 8-A: BlueBean のマイク設定 ----------

  BlueBean が VoiceMeeter の出力をマイクとして使うようにします。

  1. BlueBean の「設定」を開く

  2.「その他設定」タブをクリック

  3.「マイク」のドロップダウンから
     「Voicemeeter Out B1 (VB-Audio Voicemeeter VAIO)」を選択する

  4.「保存」をクリック

     ※ この設定は常にそのままで OK です。
       ガイダンスを流さない時間帯でも変更する必要はありません。
       ガイダンスが再生されていないときは、物理マイクの音声だけが届きます。

  ---------- 8-B: コマンド連携設定 ----------

  1. BlueBean の「設定」を開く

  2.「コマンド連携設定」タブをクリック

  3.「応答時アクセス」の欄に以下を入力:

       （フォルダのパス）\call_helper.exe --mode=incoming --number=

     例: C:\BlueBean-CallHelper\call_helper.exe --mode=incoming --number=

  4. --number= の直後にカーソルがある状態で、
     下の「相手番号」ボタンをクリック
     → 着信番号のパラメータが自動挿入されます

  5.「保存」をクリック

  ---------- 登録先の選び方 ----------

  ● 応答時アクセス（推奨）
    着信ボタンを押して通話を開始したタイミングでガイダンスを再生します。

  ● 着信時アクセス
    電話が鳴った瞬間（応答前）にガイダンスを再生します。

  ※ パスは STEP 1 で配置した場所に合わせてください
  ※ --number パラメータはログ記録用です。省略しても動作に影響はありません


==============================================================
STEP 9: 通話録音機能の設定（任意）
==============================================================

  通話中の音声（オペレーター＋相手の両方）を自動で MP3 録音する機能です。
  VoiceMeeter Output から音声をキャプチャするため、
  VoiceMeeter が正しく設定されている必要があります（STEP 5 参照）。

  ---------- config.ini の録音設定 ----------

  config.ini に以下のセクションが追加されています:

    [recording]
    output_folder = D:\CallRecordings
    recording_device = Voicemeeter Out B1
    max_duration_minutes = 120

    ● output_folder
      録音 MP3 ファイルの保存先フォルダ。
      存在しない場合は自動で作成されます。

    ● recording_device
      録音に使う入力デバイス名。通常は変更不要です。

    ● max_duration_minutes
      安全上限（分）。この時間を超えると自動で録音停止します。

  ---------- BlueBean の切断時アクセス設定 ----------

  録音は着信応答時に自動で開始されます（STEP 8-B の設定で自動）。
  録音を停止するには、BlueBean の「切断時アクセス」に以下を設定します。

  1. BlueBean の「設定」→「コマンド連携設定」を開く

  2.「切断時アクセス」の欄に以下を入力:

       （フォルダのパス）\call_helper.exe --mode=stop-recording

     例: C:\BlueBean-CallHelper\call_helper.exe --mode=stop-recording

  3.「保存」をクリック

  ---------- 録音ファイルについて ----------

  録音ファイルは以下の形式で保存されます:

    recording_YYYYMMDD_HHMMSS_電話番号.mp3

    例: recording_20260220_141530_07032962691.mp3

  ---------- 手動テスト ----------

  1. 録音開始:
       call_helper.exe --mode=record --number=0312345678

  2. 数秒後に別のコマンドプロンプトで録音停止:
       call_helper.exe --mode=stop-recording

  3. output_folder に MP3 ファイルが作成されていれば成功です。


==============================================================
ログファイルについて
==============================================================

  アプリの実行記録は call_helper.exe と同じフォルダに
  「call_helper.log」として保存されます。

  問題が起きた場合はこのファイルの内容を確認してください。


==============================================================
困ったときは
==============================================================

  ● 音声ガイダンスが相手に聞こえない
    → VoiceMeeter が起動しているか確認
    → VoiceMeeter の HARDWARE INPUT 2 に CABLE Output が設定されているか確認
    → VoiceMeeter の B1 ボタンが両方の入力で有効になっているか確認
    → BlueBean のマイクが VoiceMeeter Output に設定されているか確認（STEP 8-A）

  ● 自分の声が相手に聞こえない
    → VoiceMeeter の HARDWARE INPUT 1 に物理マイクが設定されているか確認
    → VoiceMeeter の HARDWARE INPUT 1 の B1 ボタンが有効か確認

  ● マイクがミュートされたまま戻らない
    → 画面右下のスピーカーアイコンを右クリック
    →「サウンドの設定」→「入力」からマイクのミュートを手動で解除

  ● スピーカーがミュートされたまま戻らない
    → 画面右下のスピーカーアイコンをクリック
    → ミュートになっていれば解除してください

  ● call_helper.exe が起動しない / エラーが出る
    → Windows Defender やウイルス対策ソフトにブロックされている可能性があります
    →「詳細情報」→「実行」を選ぶか、ウイルス対策ソフトの除外設定に追加してください
